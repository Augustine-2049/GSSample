# 目标
- 根据3DGS管线后处理，增加场景记录的PSNR。对于前景，使用NeRF Synthesis数据集，使用原生script生成500个图片，每7个作为训练集，1个作为测试集
- 目标数据集：NeRF Synthesis
	- 对比工作：
		- 2023ICCV Zip-NeRF：NeRF中的SOTA，引用600
		- 2024NIPS 3DGS-MCMC：3DGS中的SOTA，引用100
	- ps : start with 100K randomly  initialized points.

| 场景        | 3DGS(30K) paper | Zip-NeRF | 3DGS-MCMC | DBK(30K) |
| --------- | --------------- | -------- | --------- | -------- |
| chair     | 35.83           | 34.84    | 36.51     | 36.74    |
| drums     | 26.15           | 25.84    | 26.29     | 26.78    |
| ficus     | 34.87           | 33.9     | 35.07     | 36.75    |
| hotdog    | 37.72           | 37.14    | 37.82     | 38.85    |
| lego      | 35.78           | 34.84    | 36.01     | 37.12    |
| materials | 30.00           | 31.66    | 30.59     | 31.12    |
| mic       | 35.36           | 35.15    | 37.29     | 37.66    |
| ship      | 30.80           | 31.38    | 30.82     | 32.13    |
| **平均**    | **33.32**       | 33.10    | 33.80     | 34.64    |

python train.py -s G:\800_DataSet\NeRF_Synthesis\3DGS_nerf_synthesis\chair


# 点云渲染性能实验记录
## 20250818-20250824
- NeRF-synthesis难点：
	- drums：高光、半透明
	- materials：高光
	- lego：高光
	- ship：水
- DBK 7k 评估耗时 40min
	- 30K 2h
	- 控制点数量为30 0000

跑3DGS：
- 内存受限

| 场景        | 3DGS(30K) paper | 3DGS(7K)  | point_num |
| --------- | --------------- | --------- | --------- |
| chair     | 35.83           | 32.52     | 33w       |
| drums     | 26.15           | 25.56     | 21w       |
| ficus     | 34.87           | 30.16     | 18w       |
| hotdog    | 37.72           | 35.82     | 12w       |
| lego      | 35.78           | 34.21     | 27w       |
| materials | 30.00           | 27.82     | 11w       |
| mic       | 35.36           | 32.26     | 11w       |
| ship      | 30.80           | 29.16     | 18w       |
| **平均**    | **33.32**       | **30.81** |           |


跑DBS：
- 7k = 4min
- 30k = 18min
- dynamic = 40min
- 控制点数量为30 0000

| 场景        | DBS(7K) | DBS(30K) | DBS(dynamic) |
| --------- | ------- | -------- | -----------: |
| chair     | 33.24   | 38.41    |        38.82 |
| drums     | 26.75   | 29.66    |        30.25 |
| ficus     | 34.47   | 39.21    |        39.83 |
| hotdog    | 35.89   | 42.11    |        42.63 |
| lego      | 35.10   | 40.01    |        40.66 |
| materials | 31.25   | 35.06    |        35.59 |
| mic       | 30.15   | 40.05    |        41.02 |
| ship      | 30.99   | 33.24    |        33.38 |
| **平均**    | 32.23   | 37.23    |        37.77 |




总结当前SOTA的一些方法：

| 方法                  | NeRF_Synthesis_mean |
| ------------------- | ------------------- |
| 3DGS(30K)paper      | 33.32               |
| **DBS(dynamic)**    | **37.77**           |
| 3DGSRT(30K)paper    | 33.48               |
| 3DGS-MCMC(30K)paper | 33.80               |
| Zip-NeRF(30K)       | 33.10               |





### 本周计划
- [x] NeRF Synthesis场景构建，8个前景
	- blender版本更新，需要将大概89-90行两行注释掉
- [x] NeRF Synthesis的GS场景生成，pipeline读取：7000iter
- [x] 构建NeRF Synthesis的transforms_video.json，实现30°俯视看向中心环绕一周。然后渲染视频
- [x] 实时交互
- [x] 跑test结果，对比3DGS7K下测试集仍然存在哪些问题。
- [ ] 跑其他SOTA的test，对比结果。
- [ ] 根据设计好的transforms.json在blender中渲染视频







## 20250729-20250803
### 性能对比表
| 实验ID | 渲染方式 | 点云数量 | 分辨率 | 帧率(FPS) | 点大小 | 采样次数 | 备注 |
|--------|----------|----------|--------|-----------|--------|----------|------|
| 1 | 3DGS | 2,000,000 | 1920×1080 | 12(24) | - | - | baseline |
| 2 | GLSLv0.4 | 2,000,000 | 1920×1080 | 0.12 | 1 | 16384 | 2通道渲染，填充孔洞3NN，完全采样 |
| 3 | GLSLv0.4 | 2,000,000 | 1920×1080 | 0.12 | 1 | 16384 | 正比体积、透明度采样 |
| 4 | GLSLv0.4 | 2,000,000 | 1920×1080 | 2 | 1 | 1024 | 舍去分布两端的15%点 |
| - | GLSLv0.5 | 2,000,000 | 1920×1080 | 5 | 1 | 1024 | 双线程，双缓冲 |
| 6L | 3DGS | 1,000,000 | 616×409 | 66 | 1 | 256 | ------------ |
| 6R | GLSLv0.5 | 1,000,000 | 616×409 | 16 | 1 | 256 | ------------- |



| 实验ID | 渲染方式 | 点云数量 | 分辨率 | 帧率(FPS) | 点大小 | 采样次数 | 备注 |
|--------|----------|----------|--------|-----------|--------|----------|------|
| 5 | GLSLv0.5 | 20,000 | 1920×1080 | 2 | 1 | 10240 | 3DGS部分不分裂，直接采样，效果挺烂 |
| - | GLSLv0.5 | 1,000,000 | 616×409 | 20 | 1 | 256 | 交互界面，看生成点 |

### 特征分布

#### Scale 数量级分布统计

| 数量级 | 范围 | 数量 | 百分比 |
|--------|------|------|--------|
| 10^-18 | 1.00e-18 - 1.00e-17 | 13 | 0.00% |
| 10^-17 | 1.00e-17 - 1.00e-16 | 22 | 0.00% |
| 10^-16 | 1.00e-16 - 1.00e-15 | 32 | 0.00% |
| 10^-15 | 1.00e-15 - 1.00e-14 | 61 | 0.00% |
| 10^-14 | 1.00e-14 - 1.00e-13 | 95 | 0.00% |
| 10^-13 | 1.00e-13 - 1.00e-12 | 117 | 0.00% |
| 10^-12 | 1.00e-12 - 1.00e-11 | 260 | 0.01% |
| 10^-11 | 1.00e-11 - 1.00e-10 | 752 | 0.03% |
| 10^-10 | 1.00e-10 - 1.00e-09 | 4,493 | 0.18% |
| 10^-9 | 1.00e-09 - 1.00e-08 | 44,818 | 1.81% |
| 10^-8 | 1.00e-08 - 1.00e-07 | 241,393 | 9.74% |
| 10^-7 | 1.00e-07 - 1.00e-06 | 549,971 | 22.19% |
| 10^-6 | 1.00e-06 - 1.00e-05 | 1,068,616 | 43.11% |
| 10^-5 | 1.00e-05 - 1.00e-04 | 471,746 | 19.03% |
| 10^-4 | 1.00e-04 - 1.00e-03 | 69,822 | 2.82% |
| 10^-3 | 1.00e-03 - 1.00e-02 | 22,970 | 0.93% |
| 10^-2 | 1.00e-02 - 1.00e-01 | 3,390 | 0.14% |
| 10^-1 | 1.00e-01 - 1.00e+00 | 3 | 0.00% |
| 10^0 | 1.00e+00 - 1.00e+01 | 0 | 0.00% |
| **总计** | - | **2,478,574** | **100.00%** |

**数量级范围**: -18 到 0

#### Opacity 分布详情

| 阈值范围 | 点数 | 百分比 |
|----------|------|--------|
| Opacity ≤ 0.01 | 108,036 | 4.36% |
| Opacity ≤ 0.05 | 777,682 | 31.38% |
| Opacity ≤ 0.1 | 1,224,413 | 49.40% |
| Opacity ≤ 0.5 | 2,072,235 | 83.61% |
| Opacity > 0.5 | 406,339 | 16.39% |



### 重点记录
- 制作baseline的pipeline，内容横轴不变，纵轴裁剪 : (616, 409) -> (1920, 1080)
- 实验1的24是预估的，在616分辨率下添加`torch.cuda.empty_cache()`让速率降一半。而1080p不加这行得爆显存。
- 实验2效果挺烂，得看下体积、透明度分布
- 采样后拒绝可能比较耗费资源。
    - 尝试使用Pass0，用计算着色器预计算分裂数量，但是14s/it，待细究
- 1E6+32spp单帧耗时11ms，但整个32fps，问题出在写回CPU。
    - 尝试添加队列，生产者消费者模式，速度从32fps->75fps
    - 不过写视频很慢，并且还有210ms不知道哪儿去了
    - 目前是2.4ms的pass2填了65%的洞
- PASS1 + 2E8个点：消耗60ms/frame
    - A/B测试：60ms，就说点多了导致内存交换。
    - 减少环境中点的数量，看3DGS能不能控制scale更集中一点，或者转向2DGS


### 问题
- 

### 本周计划
- 3DGS的前向pipeline [V]
- 相机信息改用images.bin和video.bin记录[V]
- 相机自由移动[V]
- 梯度图返传

### 下周计划
- NeRF synthesis场景，复现关键数据。
- 一个200 000的场景,1024次采样，理论
- 完善采样PDF


## 20250725-20250728
### 性能对比表
| 实验ID | 渲染方式 | 点云数量 | 分辨率 | 帧率(FPS) | 点大小 | 采样次数 | 备注 |
|--------|----------|----------|--------|-----------|--------|----------|------|
| 3 | GLSL v0.2 | 2,000,000 | 1920×1080 | 40 | 0.01 | 1 | GS面元渲染，远处天空效果差 |
| 4 | GLSL v0.3 | 2,000,000 | 1920×1080 | 40 | 1 | 1 | VS实例复制点，GS点渲染，一个高斯一个点，用于baseline |
| 5 | GLSL v0.3 | 2,000,000 | 1920×1080 | 6 | 1 | 128 | VS、GS同上，一个高斯128个点，近似椭球均匀采样 |
| 6 | GLSL v0.3 | 2,000,000 | 1920×1080 | 2 | 1 | 1024 | VS、GS同上，一个高斯1024正比体积采样 |
| 7 | GLSL v0.4 | 2,000,000 | 1920×1080 | 2 | 1 | 1024 | 2通道渲染，填充孔洞3NN，正比体积采样 |
| 8 | GLSL v0.4 | 2,000,000 | 1920×1080 | 30 | 1 | 10 | 2通道渲染，填充孔洞3NN，正比体积采样 |
| 9 | 3DGS | 2,000,000 | 1920×1080 | 12 | - | - | baseline |
| 10 | GLSL v0.4 | 2,000,000 | 1920×1080 | 2 | 1 | 1024 | 2通道渲染，填充孔洞3NN，正比体积采样，正比透明度采样 |


| 实验ID | 渲染方式 | 点云数量 | 分辨率 | 帧率(FPS) | 点大小 | 采样次数 | 备注 |
|--------|----------|----------|--------|-----------|--------|----------|------|
| 1 | CPU | 2,000,000 | 616x409 | 0.3 | 2 | 1 | 基础CPU实现 |
| 2 | GLSL v0.1 | 2,000,000 | 616x409 | 230 | 3 | 1 | 固定点大小，GLSL实现 |
| 5_wa | GLSL v0.3 | 2,000,000 | 1920×1080 | 6 | 1 | 128 | 【scale得求e】VS实例复制点，GS点渲染，一个高斯128个点，近似椭球均匀采样 |
| 6_wa | GLSL v0.3 | 2,000,000 | 1920×1080 | 2 | 1 | 1024 | 【scale得求e】VS、GS同上，一个高斯1024正比体积采样 |



### 问题
- 3DGS训练的时候就开始只用0阶SH？[V]
- 椭球似乎难以均匀采样 [刘政泽] 
- Pipeline：目前是在VS的实例方法来采样点 [V]
- 正比透明度结果更差 [记录在第四通道] 

### 下周计划
- 3DGS的前向pipeline
- 相机的自由移动
- 完善采样PDF







## 实验参数说明

### 硬件环境
- GPU: [3060ti-8GB]
- CPU: [i7-14700K]
- 内存: [64GB]

### 软件环境
- Python版本: [待填写]
- ModernGL版本: [待填写]
- 操作系统: Windows 10

## 关键记录

1. **GPU加速效果显著**: GLSL v0.1相比CPU实现提升了约767倍性能
2. **分辨率影响**: 从616×409提升到1920×1080，性能下降约5.75倍
3. **点数选择**: 3DGS生成点在2E6后异常缓慢，推测内存8G存不了更多

## 待测试项目

- [ ] GLSL v0.3性能测试
- [ ] 不同点云数量的性能曲线
- [ ] 内存使用情况分析
- [ ] 渲染质量对比
