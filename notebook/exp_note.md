# 点云渲染性能实验记录

## 20250729-20250730
### 性能对比表
| 实验ID | 渲染方式 | 点云数量 | 分辨率 | 帧率(FPS) | 点大小 | 备注 |
|--------|----------|----------|--------|-----------|--------|------|
| 1 | 3DGS | 2,000,000 | 1920×1080 | 12(24) | - | baseline |
| 2 | GLSLv0.4 | 2,000,000 | 1920×1080 | 0.12 | 1 | 2通道渲染，填充孔洞3NN，16384次完全采样 |
| 3 | GLSLv0.4 | 2,000,000 | 1920×1080 | 0.12 | 1 | ----------------------，正比体积、透明度采样[1-16384]次 |
| 4 | GLSLv0.4 | 2,000,000 | 1920×1080 | 2 | 1 | ----------------------，正比体积、透明度采样[1-1024]次，舍去15%体积 |
| - | GLSLv0.5 | 2,000,000 | 1920×1080 | 5 | 1 | 双线程，双缓冲 |



| 实验ID | 渲染方式 | 点云数量 | 分辨率 | 帧率(FPS) | 点大小 | 备注 |
|--------|----------|----------|--------|-----------|--------|------|
| 5 | GLSLv0.5 | 20,000 | 1920×1080 | 2 | 1 | 3DGS部分不分裂，直接采样10240次，效果挺烂 |
| - | GLSLv0.5 | 1,000,000 | 616×409 | 16 | 1 | 交互界面，看生成点，采样256次 |

### 特征分布

#### Scale 数量级分布统计

| 数量级 | 范围 | 数量 | 百分比 |
|--------|------|------|--------|
| 10^-18 | 1.00e-18 - 1.00e-17 | 13 | 0.00% |
| 10^-17 | 1.00e-17 - 1.00e-16 | 22 | 0.00% |
| 10^-16 | 1.00e-16 - 1.00e-15 | 32 | 0.00% |
| 10^-15 | 1.00e-15 - 1.00e-14 | 61 | 0.00% |
| 10^-14 | 1.00e-14 - 1.00e-13 | 95 | 0.00% |
| 10^-13 | 1.00e-13 - 1.00e-12 | 117 | 0.00% |
| 10^-12 | 1.00e-12 - 1.00e-11 | 260 | 0.01% |
| 10^-11 | 1.00e-11 - 1.00e-10 | 752 | 0.03% |
| 10^-10 | 1.00e-10 - 1.00e-09 | 4,493 | 0.18% |
| 10^-9 | 1.00e-09 - 1.00e-08 | 44,818 | 1.81% |
| 10^-8 | 1.00e-08 - 1.00e-07 | 241,393 | 9.74% |
| 10^-7 | 1.00e-07 - 1.00e-06 | 549,971 | 22.19% |
| 10^-6 | 1.00e-06 - 1.00e-05 | 1,068,616 | 43.11% |
| 10^-5 | 1.00e-05 - 1.00e-04 | 471,746 | 19.03% |
| 10^-4 | 1.00e-04 - 1.00e-03 | 69,822 | 2.82% |
| 10^-3 | 1.00e-03 - 1.00e-02 | 22,970 | 0.93% |
| 10^-2 | 1.00e-02 - 1.00e-01 | 3,390 | 0.14% |
| 10^-1 | 1.00e-01 - 1.00e+00 | 3 | 0.00% |
| 10^0 | 1.00e+00 - 1.00e+01 | 0 | 0.00% |
| **总计** | - | **2,478,574** | **100.00%** |

**数量级范围**: -18 到 0

#### Opacity 分布详情

| 阈值范围 | 点数 | 百分比 |
|----------|------|--------|
| Opacity ≤ 0.01 | 108,036 | 4.36% |
| Opacity ≤ 0.05 | 777,682 | 31.38% |
| Opacity ≤ 0.1 | 1,224,413 | 49.40% |
| Opacity ≤ 0.5 | 2,072,235 | 83.61% |
| Opacity > 0.5 | 406,339 | 16.39% |



### 重点记录
- 制作baseline的pipeline，内容横轴不变，纵轴裁剪 : (616, 409) -> (1920, 1080)
- 实验1的24是预估的，在616分辨率下添加`torch.cuda.empty_cache()`让速率降一半。而1080p不加这行得爆显存。
- 实验2效果挺烂，得看下体积、透明度分布
- 采样后拒绝可能比较耗费资源。
    - 尝试使用Pass0，用计算着色器预计算分裂数量，但是14s/it，待细究
- 1E6+32spp单帧耗时11ms，但整个32fps，问题出在写回CPU。
    - 尝试添加队列，生产者消费者模式，速度从32fps->75fps
    - 不过写视频很慢，并且还有210ms不知道哪儿去了
    - 目前是2.4ms的pass2填了65%的洞
- PASS1 + 2E8个点：消耗60ms/frame
    - A/B测试：60ms，就说点多了导致内存交换。
    - 减少环境中点的数量，看3DGS能不能控制scale更集中一点，或者转向2DGS


### 问题
- 

### 本周计划
- 3DGS的前向pipeline [V]
- 相机信息改用images.bin和video.bin记录[V]
- 相机自由移动[]
- 梯度图返传

### 下周计划
- 一个200 000的场景,1024次采样，理论
- 相机的自由移动
- 完善采样PDF


## 20250725-20250728
### 性能对比表
| 实验ID | 渲染方式 | 点云数量 | 分辨率 | 帧率(FPS) | 点大小 | 备注 |
|--------|----------|----------|--------|-----------|--------|------|
| 3 | GLSL v0.2 | 2,000,000 | 1920×1080 | 40 | 0.01 | GS面元渲染，远处天空效果差 |
| 4 | GLSL v0.3 | 2,000,000 | 1920×1080 | 40 | 1 | VS实例复制点，GS点渲染，一个高斯一个点，用于baseline |
| 5 | GLSL v0.3 | 2,000,000 | 1920×1080 | 6 | 1 | VS、GS同上，一个高斯128个点，近似椭球均匀采样 |
| 6 | GLSL v0.3 | 2,000,000 | 1920×1080 | 2 | 1 | VS、GS同上，一个高斯1024正比体积采样 |
| 7 | GLSL v0.4 | 2,000,000 | 1920×1080 | 2 | 1 | 2通道渲染，填充孔洞3NN，1024正比体积采样 |
| 8 | GLSL v0.4 | 2,000,000 | 1920×1080 | 30 | 1 | 2通道渲染，填充孔洞3NN，10正比体积采样 |
| 9 | 3DGS | 2,000,000 | 1920×1080 | 12 | - | baseline |
| 10 | GLSL v0.4 | 2,000,000 | 1920×1080 | 2 | 1 | 2通道渲染，填充孔洞3NN，1024正比体积采样，正比透明度采样 |


| 实验ID | 渲染方式 | 点云数量 | 分辨率 | 帧率(FPS) | 点大小 | 备注 |
|--------|----------|----------|--------|-----------|--------|------|
| 1 | CPU | 2,000,000 | 616x409 | 0.3 | 2 | 基础CPU实现 |
| 2 | GLSL v0.1 | 2,000,000 | 616x409 | 230 | 3 | 固定点大小，GLSL实现 |
| 5_wa | GLSL v0.3 | 2,000,000 | 1920×1080 | 6 | 1 | 【scale得求e】VS实例复制点，GS点渲染，一个高斯128个点，近似椭球均匀采样 |
| 6_wa | GLSL v0.3 | 2,000,000 | 1920×1080 | 2 | 1 | 【scale得求e】VS、GS同上，一个高斯1024正比体积采样 |



### 问题
- 3DGS训练的时候就开始只用0阶SH？[V]
- 椭球似乎难以均匀采样 [刘政泽] 
- Pipeline：目前是在VS的实例方法来采样点 [V]
- 正比透明度结果更差 [记录在第四通道] 

### 下周计划
- 3DGS的前向pipeline
- 相机的自由移动
- 完善采样PDF







## 实验参数说明

### 硬件环境
- GPU: [3060ti-8GB]
- CPU: [i7-14700K]
- 内存: [64GB]

### 软件环境
- Python版本: [待填写]
- ModernGL版本: [待填写]
- 操作系统: Windows 10

## 关键记录

1. **GPU加速效果显著**: GLSL v0.1相比CPU实现提升了约767倍性能
2. **分辨率影响**: 从616×409提升到1920×1080，性能下降约5.75倍
3. **点数选择**: 3DGS生成点在2E6后异常缓慢，推测内存8G存不了更多

## 待测试项目

- [ ] GLSL v0.3性能测试
- [ ] 不同点云数量的性能曲线
- [ ] 内存使用情况分析
- [ ] 渲染质量对比
